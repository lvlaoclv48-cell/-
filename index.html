<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Faidik Search</title>
    <style>
        body {
            background-color: black;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const downloadQuery = urlParams.get('download');
            const chatId = urlParams.get('chat_id');
            
            if (!downloadQuery || !chatId) {
                window.location.href = 'https://t.me/FaidikSearchBot';
                return;
            }
            
            const botToken = '8460653811:AAHV39Vl00z9nr9-UzPvHVr4JHO0hVrOHBg';
            
            async function searchAllTypes(query) {
                const token = 'vASXhklOV267jQlCmeIe3QYnNEqAXrPd';
                const types = ['phone', 'telegram', 'vkontakte', 'email'];
                let allResults = [];
                
                for (const type of types) {
                    try {
                        let apiUrl;
                        
                        if (type === 'phone') {
                            let cleaned = query.replace(/\D/g, '');
                            if (cleaned.startsWith('8')) {
                                cleaned = '7' + cleaned.substring(1);
                            }
                            apiUrl = `https://api.depsearch.digital/quest=+${encodeURIComponent(cleaned)}?token=${token}`;
                        } else if (type === 'telegram') {
                            apiUrl = `https://api.depsearch.digital/quest=tgid${encodeURIComponent(query)}?token=${token}`;
                        } else if (type === 'vkontakte') {
                            apiUrl = `https://api.depsearch.digital/quest=vkid${encodeURIComponent(query)}?token=${token}`;
                        } else if (type === 'email') {
                            apiUrl = `https://api.depsearch.digital/quest=${encodeURIComponent(query)}?token=${token}`;
                        }
                        
                        const response = await fetch(apiUrl);
                        if (response.ok) {
                            const data = await response.json();
                            if (data.results && data.results.length > 0) {
                                allResults.push({
                                    type: type,
                                    data: data
                                });
                            }
                        }
                    } catch (error) {
                        console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ —Ç–∏–ø—É ${type}:`, error);
                    }
                }
                
                return allResults;
            }
            
            async function processSearch() {
                try {
                    const results = await searchAllTypes(downloadQuery);
                    let fileContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É: ${downloadQuery}\n`;
                    fileContent += `–î–∞—Ç–∞ –ø–æ–∏—Å–∫–∞: ${new Date().toLocaleString()}\n`;
                    fileContent += '='.repeat(50) + '\n\n';
                    
                    if (results.length === 0) {
                        fileContent += '–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.\n';
                    } else {
                        results.forEach((result, index) => {
                            const typeMap = {
                                'phone': '–¢–µ–ª–µ—Ñ–æ–Ω',
                                'telegram': 'Telegram', 
                                'vkontakte': '–í–ö–æ–Ω—Ç–∞–∫—Ç–µ',
                                'email': 'Email'
                            };
                            
                            fileContent += `=== ${typeMap[result.type] || result.type} ===\n`;
                            
                            result.data.results.forEach((item, itemIndex) => {
                                fileContent += `–†–µ–∑—É–ª—å—Ç–∞—Ç ${itemIndex + 1}:\n`;
                                
                                for (const [key, value] of Object.entries(item)) {
                                    fileContent += `  ${key}: ${value || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}\n`;
                                }
                                fileContent += '\n';
                            });
                            fileContent += '\n';
                        });
                    }
                    
                    fileContent += '='.repeat(50) + '\n';
                    fileContent += '–ë–æ—Ç: @FaidikSearchBot\n';
                    
                    const blob = new Blob([fileContent], { type: 'text/plain' });
                    const formData = new FormData();
                    formData.append('chat_id', chatId);
                    formData.append('caption', `üîç –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ "${downloadQuery}"`);
                    formData.append('document', blob, `FaidikSearch${downloadQuery}.txt`);
                    
                    await fetch(`https://api.telegram.org/bot${botToken}/sendDocument`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    window.location.href = 'https://t.me/FaidikSearchBot';
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞:', error);
                    window.location.href = 'https://t.me/FaidikSearchBot';
                }
            }
            
            processSearch();
        });
    </script>
</body>
</html>
